device: auto

run:
  out_dir: runs
  name: default_run_name   # overwritten by stage config

model:
  patch_size: 16
  stride: 4
  freeze_backbone: true

  dinov3:
    name_or_path: facebook/dinov3-vits16-pretrain-lvd1689m
    dtype: bf16
    use_flash_attn: true

  fine_cnn:
    channels: 96
    num_blocks: 8

  heads:
    descriptor_dim: 256
    detector:
      nms_radius: 6
      tile_size: 8
      k_per_tile: 2
      max_keypoints: 1024
    reliability:
      enabled: true
    offset:
      enabled: true
      max_offset: 0.50

dataset:
  root: src/dino_slam3/data/tum_rgbd
  pad_to: 16

  frame_spacing_min: 1
  frame_spacing_max: 4
  max_frames: null

  association:
    max_rgb_depth_dt: 0.02
    max_rgb_gt_dt: 0.02

  augmentation:
    photometric:
      enabled: true
      brightness: 0.20
      contrast: 0.20
      saturation: 0.10
      hue: 0.05
    blur:
      enabled: true
      p: 0.10
      kmin: 3
      kmax: 7

training:
  epochs: 20
  batch_size: 16
  num_workers: 16
  lr: 2.0e-4
  weight_decay: 1.0e-4
  lr_min: 1.0e-6

  mixed_precision: true
  amp_dtype: bf16

  log_every: 50
  diag_batches: 3
  save_every_epoch: true

loss:
  geom:
    sample_points: 1024
    border: 8
    depth_consistency_m: 0.05

  contrastive:
    temperature: 0.07
    max_positives: 512
    weight: 1.0

  detector:
    weight: 0.50
    sparsity_weight: 0.10
    alpha: 0.25
    gamma: 2.0
    target_mean: 0.01

  offset:
    weight: 0.50

  reliability:
    weight: 0.50
    target_mean: 0.10

  # Used by trainer diagnostics / eval scripts.
  z_min_m: 0.10
