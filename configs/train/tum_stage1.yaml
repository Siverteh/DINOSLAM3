run:
  name: tum_stage1_hybrid
  out_dir: runs

device: auto
seed: 42

dataset:
  type: tum_rgbd
  root: src/dino_slam3/data/tum_rgbd
  train_sequences:
    - rgbd_dataset_freiburg1_xyz
    - rgbd_dataset_freiburg1_room
    - rgbd_dataset_freiburg2_xyz
    - rgbd_dataset_freiburg3_sitting_xyz
  val_sequences:
    - rgbd_dataset_freiburg1_desk
  input_size: 448
  frame_spacing: 1
  max_frames: null
  augmentation:
    enabled: true
    brightness: 0.2
    contrast: 0.2
    saturation: 0.2
    hue: 0.05
    gaussian_blur: 0.2

camera:
  # Intrinsics at ORIGINAL TUM resolution (usually 640x480). They will be scaled to input_size.
  fx: 525.0
  fy: 525.0
  cx: 319.5
  cy: 239.5

model:
  backbone: dinov3
  patch_size: 16
  descriptor_dim: 128
  fine_cnn:
    enabled: true
    channels: 64
    num_blocks: 6
    out_stride: 4   # fine features at H/4 Ã— W/4
  heads:
    detector:
      nms_radius: 4
      max_keypoints: 1024
    offset:
      enabled: true
    reliability:
      enabled: true

training:
  epochs: 20
  batch_size: 4
  lr: 2.0e-4
  weight_decay: 1.0e-4
  num_workers: 4
  log_every: 25
  save_every: 1
  mixed_precision: false

loss:
  # Depth/pose supervision (primary)
  geom:
    weight: 1.0
    min_depth: 0.3
    max_depth: 6.0
    sample_points: 2048
    reproj_px_thresh: 3.0

  # Descriptor contrastive loss on depth-projected correspondences
  contrastive:
    weight: 2.0
    temperature: 0.07
    num_negatives: 256

  # Repeatability (detector consistency under projection)
  repeatability:
    weight: 0.5

  # Offset regression (sub-pixel refinement)
  offset:
    weight: 0.2

  # Regularization to prevent collapse
  regularizers:
    weight: 0.2
    uniformity_weight: 1.0
    entropy_weight: 0.5
